<!doctype html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="max-w-5xl grid grid-cols-3 gap-6 mx-auto p-6">
    <!-- Left: Product -->
    <div class="col-span-2">
      <h3 class="text-xl font-bold">Shop</h3>
      <!-- Search -->
      <div class="flex gap-2 mt-4">
        <input id="search" type="text" class="px-2 py-1 border border-gray-500 rounded w-64" placeholder="Search products...">
        <button onclick="searchProductsByName()" class="px-3 py-1 bg-blue-600 text-white rounded">Search</button>
      </div>

      <!-- Product Card -->
      <div id="products" class="grid grid-cols-2 gap-4 mt-4">
      </div>
      <!-- End Product Card -->
    </div>


    <!-- Right: Cart -->
    <div class="col-span-1">
      <!-- Title -->
      <h3 class="text-xl">Cart</h3>
      <!-- List -->
      <ul id="cart" class="space-y-1">
      </ul>

      <p id="total">Total: 0</p>
  
      <button class="w-full px-3 py-2 bg-green-600 text-white rounded">Checkout</button>
    </div>
  </div>
  </div>
  <script>
    const API = 'https://fakestoreapi.com'
    let productList = []
    const productElement = document.getElementById('products')
    const searchProductsByName = () => {
      const search = document.getElementById('search').value

     const filteredProduct = productList.filter(
      product => product.title.toLowerCase().includes(search.toLowerCase())
    )
     
     renderProducts(filteredProduct)
    } 

    // Render product card
    const renderProducts = (products) => {
      productElement.innerHTML = ''

      if(products.length === 0){
        productElement.innerHTML = '<p class="text-red-500 text-center">Product not found</p>'
      }
      products.forEach(product => {
        const div = document.createElement('div')
        div.className = 'border border-none p-2 rounded bg-white'
        div.innerHTML = `
          <img class="w-full h-32 object-contain rounded mb-2 bg-gray-50" src=${product.image} />
          <h3 class="font-bold text-xl">${product.title}</h3>
          <p>$ ${product.price}</p>
          <button id="btnAddToCart" class="mt-2 px-2 py-1 bg-green-500 text-white rounded">Add To Cart</button>
        `
        div.querySelector('#btnAddToCart').onclick = () => addToCard(product)
        productElement.appendChild(div)
      });
    }

    let productCart = []
    const cartElement = document.getElementById('cart')

    // product (id, title, price, image, qty)
    const addToCard = (product)=>{
      const found = productCart.find(cart => cart.id === product.id)
      if(found){
        console.log("Product already in cart")
        found.qty += 1
      }else{
        productCart.push({
          id: product.id,
          title: product.title,
          price: product.price,
          image: product.image,
          qty: 1
        })
      }
     
      renderProductCart()
    }

    const removeCart = (product) =>{
      const found = productCart.find(cart => cart.id === product.id)
      if(found){
        found.qty -= 1
      }
      renderProductCart()
    }

    const renderProductCart = () =>{
      let total = 0
      cartElement.innerHTML = ''
      productCart.forEach(cart => {
          total  += cart.price * cart.qty
          const li = document.createElement('li')
          li.className = 'flex item-center gap-2 rounded p-2 bg-white'
          li.innerHTML = `
            <img class="w-12 h-12 object-contain rounded bg-gray-50"
              src=${cart.image}  alt="">
            <div class="flex-1">
              <p>${cart.title}</p>
              <p>$ ${cart.price} X ${cart.qty} = $ ${(cart.price * cart.qty).toFixed(2)}</p>
            </div>
            <button id="btnRemove" class="px-3 py-2 bg-red-500 rounded text-white">-</button>
          `
           li.querySelector('#btnRemove').onclick = () => removeCart(cart)
          cartElement.appendChild(li)
      })

      document.getElementById('total').innerText = `Total: $ ${total.toFixed(2)}`
    }


    // Load function
    const loadProducts = async () => {
      console.log('First load')
      try {
        const res = await fetch(`${API}/products`)
        const data = await res.json()

        productList = data

        renderProducts(productList)

        console.log("Test data",data)
      } catch (error) {
        console.error('Error loading products:', error);
      }
    }

    // Load first time
    window.onload = () =>{
      loadProducts()
    }
 
  </script>
</body>

</html>